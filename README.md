# Домашнее задание: Балансировка нагрузки с HAProxy
**Студент:** Владислав Пак  
**Курс:** Отказоустойчивость (SFLT)

---

## Задание 1: Round-robin балансировка на 4 уровне (L4)

### Описание
Настроена балансировка Round-robin на прикладном уровне (L7/HTTP) для двух Python HTTP серверов.

### Конфигурация серверов
- **Server 1:** localhost:8001 → HTML: "Server 1 - Port 8001"
- **Server 2:** localhost:8002 → HTML: "Server 2 - Port 8002"
- **HAProxy Frontend:** localhost:8888 (изменён с 8080 из-за конфликта портов)

### Конфигурационный файл HAProxy

[Ссылка на файл конфигурации](task1/config/haproxy.cfg)

### Результаты тестирования

При последовательных запросах к HAProxy на порту 8888 наблюдается строгое чередование ответов от Server 1 и Server 2 в алгоритме Round-robin.

**Вывод:** Балансировка Round-robin работает корректно. Каждый сервер получает равное количество запросов.

### Скриншоты

![task1_screenshot](task1/screenshots/Pasted%20image.png)

---

## Задание 2: Weighted Round Robin на 7 уровне (L7/HTTP)

### Описание
Настроена балансировка Weighted Round Robin на прикладном уровне (L7/HTTP) для трёх Python HTTP серверов с весами **2:3:4**. Балансировка работает только для домена `example.local`.

### Конфигурация серверов
- **Server 1:** localhost:8003 (вес 2)
- **Server 2:** localhost:8004 (вес 3)
- **Server 3:** localhost:8005 (вес 4)
- **HAProxy Frontend:** localhost:8888

### Конфигурационный файл HAProxy

[Ссылка на файл конфигурации](task2/config/haproxy.cfg)

### Принцип работы весов

При весах **2:3:4** из 9 запросов распределение:
- Server 1 (вес 2) получает 2 запроса (22.2%)
- Server 2 (вес 3) получает 3 запроса (33.3%)
- Server 3 (вес 4) получает 4 запроса (44.4%)

### Результаты тестирования

**С доменом example.local:** Из 9 тестовых запросов Server 1 получил 2, Server 2 — 3, Server 3 — 4 запроса. Weighted Round Robin работает с соотношением 2:3:4.

**Без домена example.local:** HAProxy возвращает `HTTP/1.1 403 Forbidden`. ACL фильтрация по заголовку Host работает корректно.

### Скриншоты

![task2_screenshot_1](task2/screenshots/Screenshot%20from%202026-01-18%2002-40-20.png)

![task2_screenshot_2](task2/screenshots/Screenshot%20from%202026-01-18%2002-41-41.png)

![task2_screenshot_3](task2/screenshots/Screenshot%20from%202026-01-18%2002-43-09.png)

---

## Выводы

1. Успешно настроена балансировка Round-robin на L7 (HTTP уровень)
2. Настроена Weighted Round Robin на L7 с точным соблюдением весов 2:3:4
3. Реализована ACL фильтрация по заголовку Host для домена example.local
4. Изучены различия между балансировкой на разных уровнях OSI
5. Практически применены веса серверов для управления распределением нагрузки

## Технические детали

- **Операционная система:** Ubuntu 24.04
- **HAProxy версия:** 2.8.16
- **Python версия:** 3.12
- **Используемые порты:** 8001-8005, 8888

---

**Репозиторий:** https://github.com/vpakspace/haproxy-hw
